var cal;var isFocus=false;var pickMode={"second":1,"minute":2,"hour":3,"day":4,"month":5,"year":6};var topY=0,leftX=0;function SelectDateById(e,c,a,d){var b=document.getElementById(e);if(b==null){return false}b.focus();if(b.onclick!=null){b.onclick()}else{if(b.click!=null){b.click()}else{SelectDate(b,c,a,d)}}}function SelectDate(f,e,a,g){leftX=(a==null)?leftX:a;topY=(g==null)?topY:g;if(document.getElementById("ContainerPanel")==null){InitContainerPanel()}var c=new Date();var d=c.getFullYear()-50;var b=c.getFullYear()+50;cal=(cal==null)?new Calendar(d,b,0):cal;cal.DateMode=pickMode["second"];if(e.indexOf("s")<0){cal.DateMode=pickMode["minute"]}if(e.indexOf("m")<0){cal.DateMode=pickMode["hour"]}if(e.indexOf("h")<0){cal.DateMode=pickMode["day"]}if(e.indexOf("d")<0){cal.DateMode=pickMode["month"]}if(e.indexOf("M")<0){cal.DateMode=pickMode["year"]}if(e.indexOf("y")<0){cal.DateMode=pickMode["second"]}cal.dateFormatStyleOld=cal.dateFormatStyle;cal.dateFormatStyle=e;cal.show(f)}String.prototype.toDate=function(style){var y=this.substring(style.indexOf("y"),style.lastIndexOf("y")+1);var M=this.substring(style.indexOf("M"),style.lastIndexOf("M")+1);var d=this.substring(style.indexOf("d"),style.lastIndexOf("d")+1);var h=this.substring(style.indexOf("h"),style.lastIndexOf("h")+1);var m=this.substring(style.indexOf("m"),style.lastIndexOf("m")+1);var s=this.substring(style.indexOf("s"),style.lastIndexOf("s")+1);if(s==null||s==""||isNaN(s)){s=new Date().getSeconds()}if(m==null||m==""||isNaN(m)){m=new Date().getMinutes()}if(h==null||h==""||isNaN(h)){h=new Date().getHours()}if(d==null||d==""||isNaN(d)){d=new Date().getDate()}if(M==null||M==""||isNaN(M)){M=new Date().getMonth()+1}if(y==null||y==""||isNaN(y)){y=new Date().getFullYear()}var dt;eval("dt = new Date('"+y+"', '"+(M-1)+"','"+d+"','"+h+"','"+m+"','"+s+"')");return dt};Date.prototype.format=function(b){var c={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"w+":"天一二三四五六".charAt(this.getDay()),"q+":Math.floor((this.getMonth()+3)/3),"S":this.getMilliseconds()};if(/(y+)/.test(b)){b=b.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var a in c){if(new RegExp("("+a+")").test(b)){b=b.replace(RegExp.$1,RegExp.$1.length==1?c[a]:("00"+c[a]).substr((""+c[a]).length))}}return b};Calendar.prototype.ReturnDate=function(c){if(this.dateControl!=null){this.dateControl.value=c}calendar.hide();if(this.dateControl.onchange==null){return}var b=this.dateControl.onchange.toString();b=b.substring(((b.indexOf("ValidatorOnChange();")>0)?b.indexOf("ValidatorOnChange();")+20:b.indexOf("{")+1),b.lastIndexOf("}"));var a=new Function(b);this.dateControl.changeEvent=a;this.dateControl.changeEvent()};function Calendar(b,d,c,a){this.beginYear=1950;this.endYear=2050;this.lang=0;this.dateFormatStyle="yyyy-MM-dd hh:mm:ss";if(b!=null&&d!=null){this.beginYear=b;this.endYear=d}if(c!=null){this.lang=c}if(a!=null){this.dateFormatStyle=a}this.dateControl=null;this.panel=this.getElementById("calendarPanel");this.container=this.getElementById("ContainerPanel");this.form=null;this.date=new Date();this.year=this.date.getFullYear();this.month=this.date.getMonth();this.day=this.date.getDate();this.hour=this.date.getHours();this.minute=this.date.getMinutes();this.second=this.date.getSeconds();this.colors={"cur_word":"#FFFFFF","cur_bg":"#00FF00","sel_bg":"#FFCCCC","sun_word":"#FF0000","sat_word":"#0000FF","td_word_light":"#333333","td_word_dark":"#CCCCCC","td_bg_out":"#EFEFEF","td_bg_over":"#FFCC00","tr_word":"#FFFFFF","tr_bg":"#666666","input_border":"#CCCCCC","input_bg":"#EFEFEF"}}Calendar.language={"year":[[""],[""]],"months":[["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"]],"weeks":[["日","一","二","三","四","五","六"],["SUN","MON","TUR","WED","THU","FRI","SAT"]],"hour":[["时"],["H"]],"minute":[["分"],["M"]],"second":[["秒"],["S"]],"clear":[["清空"],["CLS"]],"today":[["今天"],["TODAY"]],"pickTxt":[["确定"],["OK"]],"close":[["关闭"],["CLOSE"]]};Calendar.prototype.draw=function(){calendar=this;var mvAry=[];mvAry[mvAry.length]=' <div name="calendarForm" style="margin: 0px;">';mvAry[mvAry.length]=' <table width="100%" border="0" cellpadding="0" cellspacing="1" style="font-size:12px;">';mvAry[mvAry.length]=" <tr>";mvAry[mvAry.length]=' <th align="left" width="1%"><input style="border: 1px solid '+calendar.colors["input_border"]+";background-color:"+calendar.colors["input_bg"]+";width:16px;height:20px;";if(calendar.DateMode>pickMode["month"]){mvAry[mvAry.length]="display:none;"}mvAry[mvAry.length]='" name="prevMonth" type="button" id="prevMonth" value="&lt;" /></th>';mvAry[mvAry.length]=' <th align="center" width="98%" nowrap="nowrap"><select name="calendarYear" id="calendarYear" style="font-size:12px;"></select><select name="calendarMonth" id="calendarMonth" style="font-size:12px;';if(calendar.DateMode>pickMode["month"]){mvAry[mvAry.length]="display:none;"}mvAry[mvAry.length]='"></select></th>';
mvAry[mvAry.length]=' <th align="right" width="1%"><input style="border: 1px solid '+calendar.colors["input_border"]+";background-color:"+calendar.colors["input_bg"]+";width:16px;height:20px;";if(calendar.DateMode>pickMode["month"]){mvAry[mvAry.length]="display:none;"}mvAry[mvAry.length]='" name="nextMonth" type="button" id="nextMonth" value="&gt;" /></th>';mvAry[mvAry.length]=" </tr>";mvAry[mvAry.length]=" </table>";mvAry[mvAry.length]=' <table id="calendarTable" width="100%" style="border:0px solid #CCCCCC;background-color:#FFFFFF;font-size:12px;';if(calendar.DateMode>=pickMode["month"]){mvAry[mvAry.length]="display:none;"}mvAry[mvAry.length]='" border="0" cellpadding="3" cellspacing="1">';mvAry[mvAry.length]=" <tr>";for(var i=0;i<7;i++){mvAry[mvAry.length]=' <th style="font-weight:normal;background-color:'+calendar.colors["tr_bg"]+";color:"+calendar.colors["tr_word"]+';">'+Calendar.language["weeks"][this.lang][i]+"</th>"}mvAry[mvAry.length]=" </tr>";for(var i=0;i<6;i++){mvAry[mvAry.length]=' <tr align="center">';for(var j=0;j<7;j++){if(j==0){mvAry[mvAry.length]=' <td style="cursor:default;color:'+calendar.colors["sun_word"]+';"></td>'}else{if(j==6){mvAry[mvAry.length]=' <td style="cursor:default;color:'+calendar.colors["sat_word"]+';"></td>'}else{mvAry[mvAry.length]=' <td style="cursor:default;"></td>'}}}mvAry[mvAry.length]=" </tr>"}mvAry[mvAry.length]=' <tr style="';if(calendar.DateMode>=pickMode["day"]){mvAry[mvAry.length]="display:none;"}mvAry[mvAry.length]='"><td align="center" colspan="7">';mvAry[mvAry.length]=' <select name="calendarHour" id="calendarHour" style="font-size:12px;"></select>'+Calendar.language["hour"][this.lang];mvAry[mvAry.length]='<span style="';if(calendar.DateMode>=pickMode["hour"]){mvAry[mvAry.length]="display:none;"}mvAry[mvAry.length]='"><select name="calendarMinute" id="calendarMinute" style="font-size:12px;"></select>'+Calendar.language["minute"][this.lang]+"</span>";mvAry[mvAry.length]='<span style="';if(calendar.DateMode>=pickMode["minute"]){mvAry[mvAry.length]="display:none;"}mvAry[mvAry.length]='"><select name="calendarSecond" id="calendarSecond" style="font-size:12px;"></select>'+Calendar.language["second"][this.lang]+"</span>";mvAry[mvAry.length]=" </td></tr>";mvAry[mvAry.length]=" </table>";mvAry[mvAry.length]=' <div align="center" style="padding:4px 4px 4px 4px;background-color:'+calendar.colors["input_bg"]+';">';mvAry[mvAry.length]=' <input name="calendarClear" type="button" id="calendarClear" value="'+Calendar.language["clear"][this.lang]+'" style="border: 1px solid '+calendar.colors["input_border"]+";background-color:"+calendar.colors["input_bg"]+';width:40px;height:20px;font-size:12px;cursor:pointer;"/>';mvAry[mvAry.length]=' <input name="calendarToday" type="button" id="calendarToday" value="';mvAry[mvAry.length]=(calendar.DateMode==pickMode["day"])?Calendar.language["today"][this.lang]:Calendar.language["pickTxt"][this.lang];mvAry[mvAry.length]='" style="border: 1px solid '+calendar.colors["input_border"]+";background-color:"+calendar.colors["input_bg"]+';width:60px;height:20px;font-size:12px;cursor:pointer"/>';mvAry[mvAry.length]=' <input name="calendarClose" type="button" id="calendarClose" value="'+Calendar.language["close"][this.lang]+'" style="border: 1px solid '+calendar.colors["input_border"]+";background-color:"+calendar.colors["input_bg"]+';width:40px;height:20px;font-size:12px;cursor:pointer"/>';mvAry[mvAry.length]=" </div>";mvAry[mvAry.length]=" </div>";this.panel.innerHTML=mvAry.join("");var obj=this.getElementById("prevMonth");obj.onclick=function(){calendar.goPrevMonth(calendar)};obj.onblur=function(){calendar.onblur()};this.prevMonth=obj;obj=this.getElementById("nextMonth");obj.onclick=function(){calendar.goNextMonth(calendar)};obj.onblur=function(){calendar.onblur()};this.nextMonth=obj;obj=this.getElementById("calendarClear");obj.onclick=function(){calendar.ReturnDate("")};this.calendarClear=obj;obj=this.getElementById("calendarClose");obj.onclick=function(){calendar.hide()};this.calendarClose=obj;obj=this.getElementById("calendarYear");obj.onchange=function(){calendar.update(calendar)};obj.onblur=function(){calendar.onblur()};this.calendarYear=obj;obj=this.getElementById("calendarMonth");with(obj){onchange=function(){calendar.update(calendar)};onblur=function(){calendar.onblur()}}this.calendarMonth=obj;obj=this.getElementById("calendarHour");obj.onchange=function(){calendar.hour=this.options[this.selectedIndex].value};obj.onblur=function(){calendar.onblur()};this.calendarHour=obj;obj=this.getElementById("calendarMinute");obj.onchange=function(){calendar.minute=this.options[this.selectedIndex].value};obj.onblur=function(){calendar.onblur()};this.calendarMinute=obj;obj=this.getElementById("calendarSecond");obj.onchange=function(){calendar.second=this.options[this.selectedIndex].value};obj.onblur=function(){calendar.onblur()};this.calendarSecond=obj;obj=this.getElementById("calendarToday");obj.onclick=function(){var today=(calendar.DateMode!=pickMode["day"])?new Date(calendar.year,calendar.month,calendar.day,calendar.hour,calendar.minute,calendar.second):new Date();
calendar.ReturnDate(today.format(calendar.dateFormatStyle))};this.calendarToday=obj};Calendar.prototype.bindYear=function(){var b=this.calendarYear;b.length=0;for(var a=this.beginYear;a<=this.endYear;a++){b.options[b.length]=new Option(a+Calendar.language["year"][this.lang],a)}};Calendar.prototype.bindMonth=function(){var a=this.calendarMonth;a.length=0;for(var b=0;b<12;b++){a.options[a.length]=new Option(Calendar.language["months"][this.lang][b],b)}};Calendar.prototype.bindHour=function(){var c=this.calendarHour;if(c.length>0){return}var b;for(var a=0;a<24;a++){b=("00"+a+"").substr((""+a).length);c.options[c.length]=new Option(b,b)}};Calendar.prototype.bindMinute=function(){var c=this.calendarMinute;if(c.length>0){return}var b;for(var a=0;a<60;a++){b=("00"+a+"").substr((""+a).length);c.options[c.length]=new Option(b,b)}};Calendar.prototype.bindSecond=function(){var c=this.calendarSecond;if(c.length>0){return}var b;for(var a=0;a<60;a++){b=("00"+a+"").substr((""+a).length);c.options[c.length]=new Option(b,b)}};Calendar.prototype.goPrevMonth=function(a){if(this.year==this.beginYear&&this.month==0){return}this.month--;if(this.month==-1){this.year--;this.month=11}this.date=new Date(this.year,this.month,1);this.changeSelect();this.bindData()};Calendar.prototype.goNextMonth=function(a){if(this.year==this.endYear&&this.month==11){return}this.month++;if(this.month==12){this.year++;this.month=0}this.date=new Date(this.year,this.month,1);this.changeSelect();this.bindData()};Calendar.prototype.changeSelect=function(){var e=this.calendarYear;var a=this.calendarMonth;var c=this.calendarHour;var d=this.calendarMinute;var b=this.calendarSecond;e[this.date.getFullYear()-this.beginYear].selected=true;a[this.date.getMonth()].selected=true;c[this.hour].selected=true;d[this.minute].selected=true;b[this.second].selected=true};Calendar.prototype.update=function(a){this.year=a.calendarYear.options[a.calendarYear.selectedIndex].value;this.month=a.calendarMonth.options[a.calendarMonth.selectedIndex].value;this.date=new Date(this.year,this.month,1);this.bindData()};Calendar.prototype.bindData=function(){var d=this;if(d.DateMode>=pickMode["month"]){return}var c=this.getMonthViewArray(this.date.getFullYear(),this.date.getMonth());var b=this.getElementById("calendarTable").getElementsByTagName("td");for(var a=0;a<b.length;a++){b[a].style.backgroundColor=d.colors["td_bg_out"];b[a].onclick=function(){return};b[a].onmouseover=function(){return};b[a].onmouseout=function(){return};if(a>c.length-1){break}b[a].innerHTML=c[a];if(c[a]!="&nbsp;"){b[a].bgColorTxt="td_bg_out";var e=new Date();b[a].isToday=false;if(e.getFullYear()==d.date.getFullYear()&&e.getMonth()==d.date.getMonth()&&e.getDate()==c[a]){b[a].style.backgroundColor=d.colors["cur_bg"];b[a].bgColorTxt="cur_bg";b[a].isToday=true}if(d.dateControl!=null){e=d.dateControl.value.toDate(d.dateFormatStyle);if(e.getFullYear()==d.date.getFullYear()&&e.getMonth()==d.date.getMonth()&&e.getDate()==c[a]){d.selectedDayTD=b[a];b[a].style.backgroundColor=d.colors["sel_bg"];b[a].bgColorTxt="sel_bg"}}b[a].onclick=function(){if(d.DateMode==pickMode["day"]){d.ReturnDate(new Date(d.date.getFullYear(),d.date.getMonth(),this.innerHTML).format(d.dateFormatStyle))}else{if(d.selectedDayTD!=null){d.selectedDayTD.style.backgroundColor=(d.selectedDayTD.isToday)?d.colors["cur_bg"]:d.colors["td_bg_out"]}this.style.backgroundColor=d.colors["sel_bg"];d.day=this.innerHTML;d.selectedDayTD=this}};b[a].style.cursor="pointer";b[a].onmouseover=function(){this.style.backgroundColor=d.colors["td_bg_over"]};b[a].onmouseout=function(){if(d.selectedDayTD!=this){this.style.backgroundColor=d.colors[this.bgColorTxt]}};b[a].onblur=function(){d.onblur()}}}};Calendar.prototype.getMonthViewArray=function(f,a){var e=[];var d=new Date(f,a,1).getDay();var c=new Date(f,a+1,0).getDate();for(var b=0;b<42;b++){e[b]="&nbsp;"}for(var b=0;b<c;b++){e[b+d]=b+1}return e};Calendar.prototype.getElementById=function(id){if(typeof(id)!="string"||id==""){return null}if(document.getElementById){return document.getElementById(id)}if(document.all){return document.all(id)}try{return eval(id)}catch(e){return null}};Calendar.prototype.getElementsByTagName=function(a,b){if(document.getElementsByTagName){return document.getElementsByTagName(b)}if(document.all){return document.all.tags(b)}};Calendar.prototype.getAbsPoint=function(b){var a=b.offsetLeft;var c=b.offsetTop;while(b=b.offsetParent){a+=b.offsetLeft;c+=b.offsetTop}return{"x":a,"y":c}};Calendar.prototype.show=function(b,a){if(b==null){throw new Error("arguments[0] is necessary")}this.dateControl=b;var c=new Date();this.date=(b.value.length>0)?new Date(b.value.toDate(this.dateFormatStyle)):c.format(this.dateFormatStyle).toDate(this.dateFormatStyle);if(this.panel.innerHTML==""||cal.dateFormatStyleOld!=cal.dateFormatStyle){this.draw();this.bindYear();this.bindMonth();this.bindHour();this.bindMinute();this.bindSecond()}this.year=this.date.getFullYear();this.month=this.date.getMonth();this.day=this.date.getDate();
this.hour=this.date.getHours();this.minute=this.date.getMinutes();this.second=this.date.getSeconds();this.changeSelect();this.bindData();if(a==null){a=b}var d=this.getAbsPoint(a);this.panel.style.left=(d.x+leftX)+"px";this.panel.style.top=(d.y+topY+b.offsetHeight)+"px";this.panel.style.display="";this.container.style.display="";if(!this.dateControl.isTransEvent){this.dateControl.isTransEvent=true;if(this.dateControl.onblur!=null){this.dateControl.blurEvent=this.dateControl.onblur}this.dateControl.onblur=function(){calendar.onblur();if(typeof(this.blurEvent)=="function"){this.blurEvent()}}}this.container.onmouseover=function(){isFocus=true};this.container.onmouseout=function(){isFocus=false}};Calendar.prototype.hide=function(){this.panel.style.display="none";this.container.style.display="none";isFocus=false};Calendar.prototype.onblur=function(){if(!isFocus){this.hide()}};function InitContainerPanel(){var a='<div id="calendarPanel" style="position: absolute;display: none;z-index:9999; background-color: #FFFFFF;border: 1px solid #CCCCCC;width:175px;font-size:12px;"></div>';if(document.all){a+='<iframe style="position:absolute;z-index:2000;width:expression(this.previousSibling.offsetWidth);';a+="height:expression(this.previousSibling.offsetHeight);";a+="left:expression(this.previousSibling.offsetLeft);top:expression(this.previousSibling.offsetTop);";a+='display:expression(this.previousSibling.style.display);" scrolling="no" frameborder="no"></iframe>'}var b=document.createElement("div");b.innerHTML=a;b.id="ContainerPanel";b.style.display="none";document.body.appendChild(b)};